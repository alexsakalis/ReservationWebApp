<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Reservations</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { padding: 20px; }
        #reservations { margin-top: 20px; }
        .reservation-card {
            border: 1px solid #ccc;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="mt-4">Reservation List</h1>
        <div id="reservations" class="mt-3"></div>
    </div>

    <script>
        fetch('/api/reservations')
            .then(response => {
                if(!response.ok) {
                    throw new Error('Network response was not ok')
                }
            return response.json()})
            .then(data => {
                const reservationsDiv = document.getElementById('reservations');
                data.forEach((reservation) => {
                    const div = document.createElement('div');
                    div.className = 'reservation-card';
                    div.innerHTML = `
                        <p><strong>Name:</strong> <span id="name-${reservation._id}">${reservation.name}</span></p>
                        <p><strong>Email:</strong> <span id="email-${reservation._id}">${reservation.email}</span></p>
                        <p><strong>Phone:</strong> <span id="phone-${reservation._id}">${reservation.phone}</span></p>
                        <p><strong>Date:</strong> <span id="date-${reservation._id}">${new Date(reservation.date).toLocaleString()}</span></p>
                        <p><strong>Time:</strong> <span id="time-${reservation._id}">${reservation.time}</span></p>
                        <p><strong>Number of People:</strong> <span id="party-size-${reservation._id}">${reservation.party_size}</span></p>
                    `;

                    // Create Edit button
                    const editButton = document.createElement('button');
                    editButton.textContent = 'Edit';
                    editButton.onclick = function() {
                        redirectToEditPage(reservation._id);
                    };

                    // Create Delete button
                    const deleteButton = document.createElement('button');
                    deleteButton.textContent = 'Delete';
                    deleteButton.onclick = function() {
                        deleteReservation(reservation._id);
                    };

                    // Append buttons to div
                    div.appendChild(editButton);
                    div.appendChild(deleteButton);

                    reservationsDiv.appendChild(div);
                });

            })
            .catch(error => console.error('Error fetching reservations:', error));

        function editReservation(id) {
            window.location.href = `reservation-edit.html?reservationId=${id}`;
        }


        async function deleteReservation(id) {
            const confirmation = confirm('Are you sure you want to delete this reservation?');
            if (confirmation) {
                try {
                    const response = await fetch(`/api/reservations/${id}`, { method: 'DELETE' });
                    if (!response.ok) {
                        throw new Error('Error deleting reservation');
                    }
                    alert('Reservation successfully deleted.');
                    location.reload();
                } catch (error) {
                    alert('Failed to delete reservation.');
                    console.error('Error:', error);
                }
            } else {
                alert('Reservation cancellation has been confirmed.');
                alert('This reservation has been cancelled.');
                location.reload();
            }
        }

        function redirectToEditPage(reservationId) {
            window.location.href = `reservation-edit.html?reservationId=${reservationId}`;
}



    </script>
</body>
</html>
